<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=640, height=960, initial-scale=0.5, user-scalable=no"
      name="viewport"
    />
    <title>Word Guessing Game</title>
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      .active {
        display: block !important;
      }

      .screen {
        display: none;
        width: 640px;
        height: 960px;
        position: absolute;
        top: calc(50% - 480px);
        left: calc(50% - 320px);
        border: 1px solid black;
      }

      #start-menu-screen .container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100%;
      }

      /* Styles for the game title */
      #game-title {
        font-size: 3em;
        margin-bottom: 50px;
      }

      /* Styles for buttons */
      button {
        padding: 15px 30px;
        font-size: 1.2em;
        margin: 10px;
        cursor: pointer;
      }

      /* Styles for the game container */
      #game-container .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding-top: 20px;
      }

      /* Styles for the truthy word display */
      #truthy-word-display {
        font-size: 2em;
        letter-spacing: 0.5em;
        margin-bottom: 20px;
      }

      /* Styles for the guess input */
      #guess-input {
        width: 60%;
        padding: 10px;
        font-size: 1em;
        text-align: center;
        margin-top: 10px;
      }

      /* Styles for the submit guess button */
      #submit-guess-button {
        padding: 10px 20px;
        font-size: 1em;
        margin-top: 20px;
      }

      /* Styles for the message display */
      #message {
        margin-top: 20px;
        font-size: 1.2em;
        color: red;
        text-align: center;
        width: 80%;
      }

      /* Styles for the game over screen */
      #game-over-screen .container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100%;
      }

      #game-over-message {
        font-size: 2em;
        margin-bottom: 20px;
      }

      #game-over-details {
        font-size: 1.5em;
        margin-bottom: 30px;
        text-align: center;
      }

      /* Styles for the on-screen keyboard */
      #on-screen-keyboard {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        max-width: 400px;
        margin: 20px auto;
      }

      #on-screen-keyboard button {
        width: 40px;
        height: 40px;
        margin: 5px;
        font-size: 1em;
        cursor: pointer;
      }

      /* Styles for the guess history */
      #guess-history {
        margin-top: 20px;
        width: 80%;
        text-align: center;
      }

      #guess-history ul {
        list-style-type: none;
        padding: 0;
      }

      #guess-history li {
        margin: 5px 0;
      }
    </style>
  </head>
  <body>
    <!-- Start Menu Screen -->
    <div class="active screen" id="start-menu-screen">
      <div class="container">
        <h1 id="game-title">Word Guessing Game</h1>
        <button id="play-button">Play</button>
        <button id="settings-button">Settings</button>
        <button id="instructions-button">Instructions</button>
      </div>
    </div>

    <!-- Settings Screen -->
    <div class="screen" id="settings-screen">
      <div class="container">
        <h2>Settings</h2>
        <!-- Add your settings options here -->
        <button class="main-menu-button" id="setting-back-button">Back</button>
      </div>
    </div>

    <!-- Instructions Screen -->
    <div class="screen" id="instructions-screen">
      <div class="container">
        <h2>Instructions</h2>
        <p style="width: 80%; text-align: center;">
          Guess the hidden word by entering valid English words. Letters from
          your guesses that match letters in the hidden word will be revealed.
          Keep guessing until you discover the entire word!
        </p>
        <button class="main-menu-button" id="instructions-back-button">Back</button>
      </div>
    </div>

    <!-- Game Container -->
    <div class="screen" id="game-container">
      <div class="container">
        <div id="truthy-word-display">_ _ _ _</div>
        <!-- On-screen keyboard -->
        <div id="on-screen-keyboard"></div>
        <!-- Guess input and submit button -->
        <input
          type="text"
          id="guess-input"
          maxlength="8"
          placeholder="Enter your guess"
        />
        <button id="submit-guess-button">Submit Guess</button>
        <div id="message"></div>
        <!-- Guessing history -->
        <div id="guess-history"></div>
      </div>
    </div>

    <!-- Game Over Screen -->
    <div class="screen" id="game-over-screen">
      <div class="container">
        <div id="game-over-message"></div>
        <div id="game-over-details"></div>
        <button id="play-again-button">Play Again</button>
        <button class="main-menu-button" id="game-over-main-menu-button">
          Main Menu
        </button>
      </div>
    </div>

    <!-- JavaScript Code -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        class GameUI {
          constructor() {
            this.startMenuScreen = document.getElementById('start-menu-screen');
            this.settingsScreen = document.getElementById('settings-screen');
            this.instructionsScreen = document.getElementById(
              'instructions-screen'
            );
            this.gameContainer = document.getElementById('game-container');
            this.gameOverScreen = document.getElementById('game-over-screen');
            this.truthyWordDisplay = document.getElementById(
              'truthy-word-display'
            );
            this.guessInput = document.getElementById('guess-input');
            this.message = document.getElementById('message');
            this.gameOverMessage = document.getElementById('game-over-message');
            this.gameOverDetails = document.getElementById('game-over-details');
            this.guessHistoryContainer = document.getElementById('guess-history');
          }

          swapToScreen(screen) {
            this.startMenuScreen.classList.remove('active');
            this.settingsScreen.classList.remove('active');
            this.instructionsScreen.classList.remove('active');
            this.gameContainer.classList.remove('active');
            this.gameOverScreen.classList.remove('active');
            screen.classList.add('active');
          }

          startGame() {
            this.swapToScreen(this.gameContainer);
            this.clearMessage();
            this.resetGuessInput();
            this.resetGuessHistory();
            this.generateOnScreenKeyboard();
          }

          endGame(win, targetWord, lastGuess) {
            this.swapToScreen(this.gameOverScreen);
            if (win) {
              this.gameOverMessage.textContent =
                'Congratulations! You guessed the word!';
            } else {
              this.gameOverMessage.textContent =
                'Game Over! Better luck next time!';
            }
            // Display the target word and the last guessed word
            this.gameOverDetails.innerHTML = `
              <p>The word was: <strong>${targetWord.toUpperCase()}</strong></p>
              <p>Your last guess was: <strong>${lastGuess.toUpperCase()}</strong></p>
            `;
          }

          mainMenu() {
            this.swapToScreen(this.startMenuScreen);
          }

          playAgain() {
            this.swapToScreen(this.gameContainer);
            this.clearMessage();
            this.resetGuessInput();
            this.resetGuessHistory();
            this.generateOnScreenKeyboard();
          }

          settings() {
            this.swapToScreen(this.settingsScreen);
          }

          instructions() {
            this.swapToScreen(this.instructionsScreen);
          }

          updateTruthyWordDisplay(revealedLetters) {
            this.truthyWordDisplay.textContent = revealedLetters.join(' ');
          }

          showMessage(msg) {
            this.message.textContent = msg;
          }

          clearMessage() {
            this.message.textContent = '';
          }

          resetGuessInput() {
            this.guessInput.value = '';
          }

          generateOnScreenKeyboard() {
            const keyboardContainer = document.getElementById(
              'on-screen-keyboard'
            );
            keyboardContainer.innerHTML = ''; // Clear previous buttons
            const letters = [
              ...'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
              'Backspace',
              'Enter',
            ];

            letters.forEach((letter) => {
              const button = document.createElement('button');
              button.textContent = letter;
              button.id = `key-${letter}`;
              button.addEventListener('click', () => {
                if (letter === 'Backspace') {
                  this.guessInput.value = this.guessInput.value.slice(0, -1);
                } else if (letter === 'Enter') {
                  // Trigger the submit guess button click event
                  document.getElementById('submit-guess-button').click();
                } else {
                  this.guessInput.value += letter;
                }
              });
              keyboardContainer.appendChild(button);
            });
          }

          updateGuessHistory(guess) {
            if (!this.guessHistoryList) {
              // Create a list if it doesn't exist
              this.guessHistoryList = document.createElement('ul');
              this.guessHistoryContainer.appendChild(this.guessHistoryList);
            }
            const listItem = document.createElement('li');
            listItem.textContent = guess;
            this.guessHistoryList.appendChild(listItem);
          }

          resetGuessHistory() {
            this.guessHistoryContainer.innerHTML = '';
            this.guessHistoryList = null;
          }
        }

        class GameLogic {
          constructor(wordList) {
            this.wordList = wordList;
            this.truthyWord = '';
            this.revealedLetters = [];
            this.attempts = 0;
            this.maxAttempts = 10; // You can adjust the maximum attempts
            this.lastGuess = '';
          }

          startNewGame() {
            // Choose a random word between 4 and 8 letters
            const suitableWords = this.wordList.filter(
              (word) => word.length >= 4 && word.length <= 8
            );
            this.truthyWord =
              suitableWords[
                Math.floor(Math.random() * suitableWords.length)
              ].toLowerCase();
            console.log('Truthy word:', this.truthyWord);
            this.revealedLetters = Array(this.truthyWord.length).fill('_');
            this.attempts = 0;
            this.lastGuess = '';
          }

          checkGuess(guess) {
            guess = guess.toLowerCase();
            this.lastGuess = guess;

            if (!this.wordList.includes(guess)) {
              return {
                valid: false,
                message: 'Invalid word. Please try again.',
              };
            }

            this.attempts++;

            // Reveal letters that match
            for (let i = 0; i < this.truthyWord.length; i++) {
              if (guess.includes(this.truthyWord[i])) {
                this.revealedLetters[i] = this.truthyWord[i];
              }
            }

            const isComplete = !this.revealedLetters.includes('_');
            const isGameOver = this.attempts >= this.maxAttempts;

            return { valid: true, isComplete, isGameOver };
          }

          getRevealedLetters() {
            return this.revealedLetters;
          }

          getTargetWord() {
            return this.truthyWord;
          }

          getLastGuess() {
            return this.lastGuess;
          }
        }

        class Game {
          constructor() {
            this.ui = new GameUI();
            this.logic = null;
            this.wordList = [];
          }

          prepareGame() {
            this.loadWordList().then(() => {
              this.logic = new GameLogic(this.wordList);
              this.assignButtons();
            });
          }

          async loadWordList() {
            try {
              const response = await fetch('https://raw.githubusercontent.com/dwyl/english-words/master/words_alpha.txt');
              const text = await response.text();
              this.wordList = text
                .split('\n')
                .map((word) => word.trim().toLowerCase());
            } catch (error) {
              console.error('Error loading word list:', error);
            }
          }

          startGame() {
            this.logic.startNewGame();
            this.ui.startGame();
            this.ui.updateTruthyWordDisplay(this.logic.getRevealedLetters());
          }

          handleGuess() {
            const guess = this.ui.guessInput.value.trim();

            if (!guess) {
              this.ui.showMessage('Please enter a word.');
              return;
            }

            this.ui.clearMessage();
            const result = this.logic.checkGuess(guess);

            if (!result.valid) {
              this.ui.showMessage(result.message);
              return;
            }

            this.ui.updateTruthyWordDisplay(this.logic.getRevealedLetters());
            this.ui.resetGuessInput();
            this.ui.updateGuessHistory(guess);

            if (result.isComplete) {
              this.ui.endGame(
                true,
                this.logic.getTargetWord(),
                this.logic.getLastGuess()
              );
            } else if (result.isGameOver) {
              this.ui.endGame(
                false,
                this.logic.getTargetWord(),
                this.logic.getLastGuess()
              );
            }
          }

          assignButtons() {
            const playButton = document.getElementById('play-button');
            const settingsButton = document.getElementById('settings-button');
            const instructionsButton = document.getElementById(
              'instructions-button'
            );
            const playAgainButton = document.getElementById('play-again-button');
            const mainMenuButtons = document.querySelectorAll(
              '.main-menu-button'
            );
            const submitGuessButton = document.getElementById(
              'submit-guess-button'
            );

            settingsButton.addEventListener(
              'click',
              this.ui.settings.bind(this.ui)
            );
            instructionsButton.addEventListener(
              'click',
              this.ui.instructions.bind(this.ui)
            );
            playAgainButton.addEventListener('click', this.startGame.bind(this));
            mainMenuButtons.forEach((button) =>
              button.addEventListener('click', this.ui.mainMenu.bind(this.ui))
            );
            playButton.addEventListener('click', this.startGame.bind(this));
            submitGuessButton.addEventListener(
              'click',
              this.handleGuess.bind(this)
            );

            // Allow pressing Enter key to submit guess
            this.ui.guessInput.addEventListener('keyup', (event) => {
              if (event.key === 'Enter') {
                this.handleGuess();
              }
            });
          }
        }

        const game = new Game();
        game.prepareGame();
      });
    </script>
  </body>
</html>
